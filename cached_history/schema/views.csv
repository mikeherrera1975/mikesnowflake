|created_on|name|reserved|database_name|schema_name|owner|comment|text|is_secure|is_materialized
0|2019-05-17 22:52:22.736000+00:00|CURRENCY_EXCHANGE_CURRENT_FACT_VIEW||PROD|MSTR_DATAMART|SYSADMIN||"CREATE OR REPLACE VIEW CURRENCY_EXCHANGE_CURRENT_FACT_VIEW 
AS 
select base,
       currency,
       date,
       exchange_rate,
       last_oanda_updated,
       date_sid
from (
       select *,       
              row_number() over (partition by base, currency, date_sid order by exchange_rate) as rn
         from CURRENCY_EXCHANGE_DAILY_FACT 
        where date_sid in (select max(date_sid) 
                             from CURRENCY_EXCHANGE_DAILY_FACT)
                             )
where rn = 1;"|false|false
1|2018-05-01 07:31:45.331000+00:00|DISCARD_DATA_VIEW||PROD|MSTR_DATAMART|PROD_ETL_ROLE||"CREATE OR REPLACE VIEW discard_data_view AS
((((( SELECT 'AQ_LANGUAGE'::varchar(11) AS discard_reason_type,
        language_dim.language_nk AS discard_data,
        language_dim.language_name AS discard_data_name
 FROM mstr_datamart.language_dim UNION ALL  SELECT 'AQ_ATTRIBUTE'::varchar(12),
        (content_attribute_dim.content_attribute_nk)::varchar(50) AS content_attribute_nk,
        content_attribute_dim.content_attribute_name
 FROM mstr_datamart.content_attribute_dim) UNION ALL  SELECT 'AQ_TYPE'::varchar(7),
        (creative_type_dim.creative_type_nk)::varchar(50) AS creative_type_nk,
        creative_type_dim.creative_type_name
 FROM mstr_datamart.creative_type_dim) UNION ALL  SELECT 'AQ_TYPE'::varchar(7),
        'Blocked by mimetype mismatch'::varchar(28),
        'Blocked by mimetype mismatch'::varchar(28)
 FROM dual) UNION ALL  SELECT 'BRAND'::varchar(5),
        (brand_dim.brand_nk)::varchar(50) AS brand_nk,
        brand_dim.brand_name
 FROM mstr_datamart.brand_dim) UNION ALL  SELECT 'BRAND'::varchar(5),
        (brand_combo_dim.brand_combo_nk)::varchar(50) AS brand_combo_nk,
        brand_combo_dim.brand_combo_name
 FROM mstr_datamart.brand_combo_dim) UNION ALL  SELECT 'INDUSTRY'::varchar(8),
        (brand_industry_dim.brand_id)::varchar(50) AS brand_id,
        brand_industry_dim.brand_industry
 FROM mstr_datamart.brand_industry_dim;"|false|false
2|2020-01-08 23:05:09.601000+00:00|VIEWABILITY_BUYER_BRAND_SUM_DAILY_FACT_VIEW||PROD|MSTR_DATAMART|ACCOUNTADMIN||"CREATE OR REPLACE VIEW viewability_buyer_brand_sum_daily_fact_view AS
 SELECT b.instance_rollup_date,
        b.instance_date_sid,
        b.p_platform_id,
        b.publisher_account_nk,
        b.site_nk,
        b.ad_unit_nk,
        b.p_medium,
        b.p_ad_size,
        b.package_nk,
        b.deal_nk,
        b.p_deal_floor,
        b.p_deal_floor_usd,
        b.p_currency_code,
        b.country_code,
        b.a_platform_id,
        b.advertiser_account_nk,
        b.exclude_account_in_external_reports,
        b.partner_buyer_id,
        b.brand_nk,
        b.domain,
        b.a_currency_code,
        b.u_mobl_dev_cat,
        b.is_mobile_app,
        b.p_mapped_adunit_type,
        b.x_bidder_elig,
        b.p_adunit_presentation_format,
        b.p_adunit_presentation_subformat,
        b.x_gd_platform_id,
        b.x_gd_package_id,
        b.x_gd_deal_id,
        b.x_exchange_fee_applied,
        b.x_apply_pd_fees,
        b.deal_win_type,
        dd.pmp_deal_type,
        dd.lifetime_impression_goal,
        dd.start_date,
        dd.end_date,
        b.tot_viewables_ias AS tot_viewables_ias,
        b.tot_view_measurables_ias AS tot_view_measurables_ias,
        b.tot_sum_traq_ias AS tot_sum_traq_ias,
        b.tot_count_traq_ias AS tot_count_traq_ias,
        b.tot_viewables_moat AS tot_viewables_moat,
        b.tot_view_measurables_moat AS tot_view_measurables_moat,
        b.tot_sum_traq_moat AS tot_sum_traq_moat,
        b.tot_count_traq_moat AS tot_count_traq_moat,
        0 AS tot_bid_requests,
        0 AS tot_opportunities,
        0 AS tot_pos_bid_opportunities,
        0 AS tot_total_pos_bid_gross,
        0 AS tot_total_pos_bid_gross_usd,
        0 AS tot_total_pos_bid_net,
        0 AS tot_total_pos_bid_net_usd,
        0 AS tot_mkt_impressions,
        0 AS tot_total_winning_bid_gross,
        0 AS tot_total_winning_bid_gross_usd,
        0 AS tot_total_winning_bid_net,
        0 AS tot_total_winning_bid_net_usd,
        0 AS tot_a_mkt_spend,
        0 AS tot_a_mkt_spend_usd,
        0 AS tot_p_mkt_revenue,
        0 AS tot_p_mkt_revenue_usd
 FROM viewability_buyer_brand_sum_daily_fact b
 LEFT JOIN deal_dim dd
   ON (b.deal_nk = dd.deal_nk)
 UNION ALL
 SELECT a.instance_rollup_date,
        a.instance_date_sid,
        a.p_platform_id,
        a.publisher_account_nk,
        a.site_nk,
        a.ad_unit_nk,
        a.p_medium,
        a.p_ad_size,
        a.package_nk,
        a.deal_nk,
        a.p_deal_floor,
        a.p_deal_floor_usd,
        a.p_currency_code,
        a.country_code,
        a.a_platform_id,
        a.advertiser_account_nk,
        a.exclude_account_in_external_reports,
        a.partner_buyer_id,
        a.brand_nk,
        a.domain,
        a.a_currency_code,
        a.u_mobl_dev_cat,
        a.is_mobile_app,
        a.p_mapped_adunit_type,
        a.x_bidder_elig,
        a.p_adunit_presentation_format,
        a.p_adunit_presentation_subformat,
        a.x_gd_platform_id,
        a.x_gd_package_id,
        a.x_gd_deal_id,
        a.x_exchange_fee_applied,
        a.x_apply_pd_fees,
        a.deal_win_type,
        dd.pmp_deal_type,
        dd.lifetime_impression_goal,
        dd.start_date,dd.end_date,
        0 AS tot_viewables,
        0 AS tot_view_measurables,
        0 AS tot_sum_traq,
        0 AS tot_count_traq,
        0 AS tot_viewables_moat,
        0 AS tot_view_measurables_moat,
        0 AS tot_sum_traq_moat,
        0 AS tot_count_traq_moat,
        a.tot_bid_requests AS tot_bid_requests,
        a.tot_opportunities AS tot_opportunities,
        a.tot_pos_bid_opportunities AS tot_pos_bid_opportunities,
        a.tot_total_pos_bid_gross AS tot_total_pos_bid_gross,
        a.tot_total_pos_bid_gross_usd AS tot_total_pos_bid_gross_usd,
        a.tot_total_pos_bid_net AS tot_total_pos_bid_net,
        a.tot_total_pos_bid_net_usd AS tot_total_pos_bid_net_usd,
        a.tot_mkt_impressions AS tot_mkt_impressions,
        a.tot_total_winning_bid_gross AS tot_total_winning_bid_gross,
        a.tot_total_winning_bid_gross_usd AS tot_total_winning_bid_gross_usd,
        a.tot_total_winning_bid_net AS tot_total_winning_bid_net,
        a.tot_total_winning_bid_net_usd AS tot_total_winning_bid_net_usd,
        a.tot_a_mkt_spend AS tot_a_mkt_spend,
        a.tot_a_mkt_spend_usd AS tot_a_mkt_spend_usd,
        a.tot_p_mkt_revenue AS tot_p_mkt_revenue,
        a.tot_p_mkt_revenue_usd AS tot_p_mkt_revenue_usd
   FROM ox_buyer_brand_sum_daily_fact a
   LEFT JOIN deal_dim dd
     ON (a.deal_nk = dd.deal_nk);"|false|false
3|2019-04-01 19:05:14.988000+00:00|VIEWABILITY_SUPPLY_DEMAND_COUNTRY_DAILY_VIEW||PROD|MSTR_DATAMART|PROD_ETL_ROLE||"CREATE OR REPLACE VIEW viewability_supply_demand_country_daily_view AS
 SELECT b.instance_rollup_date,
        b.instance_date_sid,
        b.a_platform_id,
        b.p_platform_id,
        b.publisher_account_nk,
        b.site_nk,
        b.site_section_nk,
        b.page_nk,
        b.ad_unit_nk,
        b.rev_split,
        b.deal_type_uid,
        b.deal_cpm,
        b.rev_share_enabled,
        b.package_nk,
        b.deal_nk,
        b.advertiser_account_nk,
        b.order_nk,
        b.line_item_nk,
        b.ad_nk,
        b.line_item_pricing_model_code,
        b.line_item_pricing_rate,
        b.brand_nk,
        b.delivery_medium_code,
        b.screen_location_code,
        b.content_topic_group_sid,
        b.sales_channel_code,
        b.p_currency_code,
        b.a_currency_code,
        b.country_code,
        b.ad_width,
        b.ad_height,
        b.ad_duration,
        b.ssp_elig,
        b.p_req_deliv_medium,
        b.p_mapped_adunit_type,
        b.u_mobl_dev_cat,
        b.is_mobile_app,
        b.x_bidder_elig,
        b.p_adunit_presentation_format,
        b.p_adunit_presentation_subformat,
        b.x_gd_platform_id,
        b.x_gd_package_id,
        b.x_gd_deal_id,
        b.x_exchange_fee_applied,
        b.x_apply_pd_fees,
        b.deal_win_type,
        -- bidout
        b.p_ext_supply_partner_id,
        b.p_ext_auction_type,
        b.p_ext_cp_currency_code,

        0 AS tot_requests,
        0 AS tot_discards,
        0 AS tot_impressions,
        0 AS tot_raw_billable_impressions,
        0 AS tot_billable_impressions,
        0 AS tot_clicks,
        0 AS tot_refresh_impressions,
        0 AS tot_billable_refresh_impressions,
        0 AS tot_view_conversions,
        0 AS tot_click_conversions,
        0 AS tot_raw_revenue,
        0 AS tot_publisher_revenue,
        0 AS tot_network_revenue,
        0 AS tot_publisher_cpd_revenue,
        0 AS tot_network_cpd_revenue,
        0 AS tot_raw_conversion_revenue,
        0 AS tot_publisher_conversion_revenue,
        0 AS tot_network_conversion_revenue,
        0 AS tot_raw_spend,
        0 AS tot_spend,
        0 AS tot_raw_conversion_spend,
        0 AS tot_conversion_spend,
        0 AS tot_mkt_elig_req,
        0 AS tot_mkt_requests,
        --bidout
        0 AS tot_pub_external_raw_clearing_price,
        0 AS tot_all_clearing_price_count,
        -- ias
        b.tot_viewables_ias AS tot_viewables_ias,
        b.tot_view_measurables_ias AS tot_view_measurables_ias,
        b.tot_sum_traq_ias AS tot_sum_traq_ias,
        b.tot_count_traq_ias AS tot_count_traq_ias,
        b.tot_high_confidence_ias AS tot_high_confidence_ias,
        b.tot_high_confidence_in_view_ias AS tot_high_confidence_in_view_ias,
        b.tot_suspicious_ias AS tot_suspicious_ias,
        -- moat
        b.tot_viewables_moat AS tot_viewables_moat,
        b.tot_view_measurables_moat AS tot_view_measurables_moat,
        b.tot_sum_traq_moat AS tot_sum_traq_moat,
        b.tot_count_traq_moat AS tot_count_traq_moat,
        b.tot_high_confidence_moat AS tot_high_confidence_moat,
        b.tot_high_confidence_in_view_moat AS tot_high_confidence_in_view_moat,
        b.tot_suspicious_moat AS tot_suspicious_moat
   FROM viewability_traffic_sum_daily_fact b
 UNION ALL
 SELECT a.instance_rollup_date,
        a.instance_date_sid,
        a.a_platform_id,
        a.p_platform_id,
        a.publisher_account_nk,
        a.site_nk,
        a.site_section_nk,
        a.page_nk,
        a.ad_unit_nk,
        a.rev_split,
        a.deal_type_uid,
        a.deal_cpm,
        a.rev_share_enabled,
        a.package_nk,
        a.deal_nk,
        a.advertiser_account_nk,
        a.order_nk,
        a.line_item_nk,
        a.ad_nk,
        a.line_item_pricing_model_code,
        a.line_item_pricing_rate,
        a.brand_nk,
        a.delivery_medium_code,
        a.screen_location_code,
        a.content_topic_group_sid,
        a.sales_channel_code,
        a.p_currency_code,
        a.a_currency_code,
        a.country_code,
        a.ad_width,
        a.ad_height,
        a.ad_duration,
        a.ssp_elig,
        a.p_req_deliv_medium,
        a.p_mapped_adunit_type,
        a.u_mobl_dev_cat,
        a.is_mobile_app,
        a.x_bidder_elig,
        a.p_adunit_presentation_format,
        a.p_adunit_presentation_subformat,
        a.x_gd_platform_id,
        a.x_gd_package_id,
        a.x_gd_deal_id,
        a.x_exchange_fee_applied,
        a.x_apply_pd_fees,
        a.deal_win_type,
        -- bidout
        a.p_ext_supply_partner_id,
        a.p_ext_auction_type,
        a.p_ext_cp_currency_code,

        a.tot_requests AS tot_requests,
        a.tot_discards AS tot_discards,
        a.tot_impressions AS tot_impressions,
        a.tot_raw_billable_impressions AS tot_raw_billable_impressions,
        a.tot_billable_impressions AS tot_billable_impressions,
        a.tot_clicks AS tot_clicks,
        a.tot_refresh_impressions AS tot_refresh_impressions,
        a.tot_billable_refresh_impressions AS tot_billable_refresh_impressions,
        a.tot_view_conversions AS tot_view_conversions,
        a.tot_click_conversions AS tot_click_conversions,
        a.tot_raw_revenue AS tot_raw_revenue,
        a.tot_publisher_revenue AS tot_publisher_revenue,
        a.tot_network_revenue AS tot_network_revenue,
        a.tot_publisher_cpd_revenue AS tot_publisher_cpd_revenue,
        a.tot_network_cpd_revenue AS tot_network_cpd_revenue,
        a.tot_raw_conversion_revenue AS tot_raw_conversion_revenue,
        a.tot_publisher_conversion_revenue AS tot_publisher_conversion_revenue,
        a.tot_network_conversion_revenue AS tot_network_conversion_revenue,
        a.tot_raw_spend AS tot_raw_spend,
        a.tot_spend AS tot_spend,
        a.tot_raw_conversion_spend AS tot_raw_conversion_spend,
        a.tot_conversion_spend AS tot_conversion_spend,
        a.tot_mkt_elig_req AS tot_mkt_elig_req,
        a.tot_mkt_requests AS tot_mkt_requests,
        --bidout
        a.tot_pub_external_raw_clearing_price,
        a.tot_all_clearing_price_count,

        0 AS tot_viewables_ias,
        0 AS tot_view_measurables_ias,
        0 AS tot_sum_traq_ias,
        0 AS tot_count_traq_ias,
        0 AS tot_high_confidence_ias,
        0 AS tot_high_confidence_in_view_ias,
        0 AS tot_suspicious_ias,
        0 AS tot_viewables_moat,
        0 AS tot_view_measurables_moat,
        0 AS tot_sum_traq_moat,
        0 AS tot_count_traq_moat,
        0 AS tot_high_confidence_moat,
        0 AS tot_high_confidence_in_view_moat,
        0 AS tot_suspicious_moat
   FROM supply_demand_country_daily_fact a;"|false|false
4|2018-05-01 07:34:12.380000+00:00|VW_OX_BLOCKED_TYPES_DAILY_VIEW||PROD|MSTR_DATAMART|PROD_ETL_ROLE||"CREATE OR REPLACE VIEW vw_ox_blocked_types_daily_view AS
 SELECT b.instance_date_sid,
        b.instance_rollup_date,
        b.p_platform_id,
        b.publisher_account_nk,
        b.site_nk,
        b.discard_reason,
        b.discard_data,
        v.discard_data_name,
        b.brand_nk,
        b.p_op_coin,
        b.p_coin,
        b.tot_new_fill_cnt,
        b.tot_new_fill_est_spend,
        b.tot_new_fill_est_add_revenue,
        b.tot_price_inc_cnt,
        b.tot_price_inc_cur_spend,
        b.tot_price_inc_est_spend,
        b.tot_price_inc_cur_revenue,
        b.tot_price_inc_est_revenue,
        b.tot_price_inc_est_add_revenue,
        b.tot_adj_new_fill_est_add_revenue,
        b.tot_adj_price_inc_est_add_revenue
 FROM (mstr_datamart.ox_blocked_types_daily_fact b
 LEFT  JOIN mstr_datamart.discard_data_view v
 ON (((b.discard_reason = v.discard_reason_type) AND (b.discard_data = v.discard_data))))
 UNION ALL
 SELECT (to_char(fact_agg.utc_timestamp, 'YYYYMMDD'::varchar(8)))::int AS instance_date_sid,
        to_date(fact_agg.utc_timestamp) AS instance_rollup_date,
        fact_agg.p_platform_id,
        fact_agg.publisher_account_nk,
        fact_agg.site_nk,
        fact_agg.discard_reason,
        fact_agg.discard_data,
        v.discard_data_name,
        fact_agg.brand_nk,
        fact_agg.p_op_coin,
        fact_agg.p_coin,
        sum(fact_agg.tot_new_fill_cnt) AS SUM,
        sum(fact_agg.tot_new_fill_est_spend) AS SUM,
        sum(fact_agg.tot_new_fill_est_add_revenue) AS SUM,
        sum(fact_agg.tot_price_inc_cnt) AS SUM,
        sum(fact_agg.tot_price_inc_cur_spend) AS SUM,
        sum(fact_agg.tot_price_inc_est_spend) AS SUM,
        sum(fact_agg.tot_price_inc_cur_revenue) AS SUM,
        sum(fact_agg.tot_price_inc_est_revenue) AS SUM,
        sum(fact_agg.tot_price_inc_est_add_revenue) AS SUM,
        sum(fact_agg.tot_adj_new_fill_est_add_revenue) AS SUM,
        sum(fact_agg.tot_adj_price_inc_est_add_revenue) AS SUM
 FROM mstr_datamart.ox_blocked_types_hourly_fact fact_agg
 LEFT JOIN mstr_datamart.discard_data_view v
 ON fact_agg.discard_reason = v.discard_reason_type AND fact_agg.discard_data = v.discard_data
 INNER JOIN
 ( SELECT pd.platform_id,
             CONVERT_TIMEZONE(pd.timezone, 'UTC',trunc(
             CONVERT_TIMEZONE('UTC', pd.timezone,(
                 SELECT
                     DATEADD('hour', 1, variable_value::timestamp_ntz) AS last_utc_daily_hour
                 FROM
                     load_state a
                 WHERE
                     variable_name = 'ox_blocked_types_daily_rollup_last_hour'
             )),'dd'
             )) start_time
           FROM mstr_datamart.platform_dim pd) pdr
     ON (fact_agg.p_platform_id = pdr.platform_id)
  WHERE fact_agg.utc_timestamp >= pdr.start_time
    AND fact_agg.utc_date_sid >= to_char(DATEADD('day',-3, CONVERT_TIMEZONE('UTC',CURRENT_TIMESTAMP)),'YYYYMMDD')::int
 GROUP BY (to_char(fact_agg.utc_timestamp, 'YYYYMMDD'::varchar(8)))::int,
          to_date(fact_agg.utc_timestamp),
          fact_agg.p_platform_id,
          fact_agg.publisher_account_nk,
          fact_agg.site_nk,
          fact_agg.discard_reason,
          v.discard_data_name,
          fact_agg.discard_data,
          fact_agg.brand_nk,
          fact_agg.p_op_coin,
          fact_agg.p_coin;"|false|false
5|2019-09-04 22:24:11.769000+00:00|ADAPTIVE_INSIGHTS_DAILY_FACT_VIEW_NEW_2019||PROD|BUSINESSINTELLIGENCE|FINANCE_ROLE||"CREATE VIEW BusinessIntelligence.adaptive_insights_daily_fact_view_new_2019 AS
 SELECT f.utc_date_sid,
        f.p_platform_id AS publisher_instance_id,
        pub.platform_name AS publisher_instance_name,
        f.publisher_account_nk,
        sto.publisher_account_name AS SF_account_name,
        sto.SF_Account_ID AS SF_account_id,
        sto.MRR AS SF_MRR,
        sto.business_type AS SF_business_type,
        f.site_nk,
        f.p_mkt_op AS publisher_operator,
        f.advertiser_account_nk,
        lid.line_item_type,
        f.p_ext_supply_partner_id AS bidout_partner,
        f.is_bidder_elig,
        f.x_bidout AS is_bidout_elig,
        f.is_ssp_elig,
        f.x_nix_elig AS is_nix_elig,
        pub.is_adserver_elig,
        f.is_mkt_fill AS is_market_fill,
        f.is_ssp_fill,
        f.u_mobl_dev_cat AS device_category,
        f.p_mapped_ad_unit_type AS p_adunit_presentation_format,
        f.p_adunit_presentation_format AS video_format,
        sto.mobl_app_adserver AS mobile_app_adserver,
        sto.video_adserver,
        CASE WHEN (f.deal_win_type = 'DIDIE'::varchar(5)) THEN 'Targeted Exchange'::varchar(17) WHEN (f.deal_win_type = 'RTG'::varchar(3)) THEN 'RTG'::varchar(3) WHEN ((f.deal_win_type = 'PMP'::varchar(3)) AND (f.is_multi_pub_pmp = false)) THEN 'PMP - Single Pub'::varchar(16) WHEN ((f.deal_win_type = 'PMP'::varchar(3)) AND (f.is_multi_pub_pmp = true)) THEN 'PMP - Multi Pub'::varchar(15) ELSE NULL END AS transaction_type,
        f.a_platform_id AS advertiser_instance_id,
        apd.platform_name AS advertiser_instance_name,
        f.is_mobile_app AS environment,
        CASE WHEN (f.deal_nk IS NOT NULL) THEN true ELSE false END AS has_deal_nk,
        dd.pmp_deal_type_name AS deal_type,
        f.is_multi_pub_pmp AS is_deal_multi_pub,
        f.x_gd_deal_id AS global_deal_nk,
        dd.deal_source,
        CASE WHEN (f.a_reseller = 'CCI'::varchar(3)) THEN true ELSE false END AS advertiser_reseller_flag,
        CASE WHEN (f.p_reseller = 'CCI'::varchar(3)) THEN true ELSE false END AS publisher_reseller_flag,
        sto.pmp_client_fee,
        sto.pmp_ox_source_fee,
        sto.rtg_client_fee,
        sto.rtg_ox_source_fee,
        f.tot_unrefined_mkt_elig_req AS tot_monetization_requests,
        f.tot_mkt_elig_req AS tot_open_exchange_requests,
        f.tot_gd_deal_elig_req AS tot_te_eligible_requests,
        f.tot_pd_elig_req AS tot_pd_eligible_requests,
        f.tot_fills AS tot_rtb_fills,
        f.tot_impressions AS tot_sold_impressions,
        f.tot_a_spend_usd AS tot_spend_usd,
        (f.tot_a_spend_usd - f.tot_p_revenue_usd) AS tot_exchange_net_revenue,
        CASE WHEN ((f.p_reseller = 'CCI'::varchar(3)) AND (f.deal_win_type like 'PMP' OR f.deal_win_type like 'RTG')) THEN (f.tot_a_spend_usd * 0.1) WHEN ((f.a_reseller = 'CCI'::varchar(3)) AND (f.p_reseller = 'CCI'::varchar(3))) THEN ((f.tot_a_spend_usd - f.tot_p_revenue_usd) * 0.5) WHEN ((f.a_reseller = 'CCI'::varchar(3)) OR (f.p_reseller = 'CCI'::varchar(3))) THEN ((f.tot_a_spend_usd - f.tot_p_revenue_usd) * 0.25) ELSE 0::numeric(18,0) END AS tot_cci_revenue_share,
        CASE WHEN (f.p_reseller = 'CCI'::varchar(3)) THEN ((f.tot_mkt_elig_req * 0.005) / 1000::numeric(18,0)) ELSE 0::numeric(18,0) END AS tot_cci_technical_platform_cost
 FROM ((((((mstr_datamart.adaptive_insights_daily_fact f JOIN ( SELECT pd.platform_id AS p_platform_id,
        pd.platform_name,
        pub.publisher_account_nk,
        pub.publisher_account_name,
        CASE WHEN (sfp.Instance_ID__c IS NOT NULL) THEN true ELSE NULL::boolean END AS is_adserver_elig,
        sfp.Status__c AS status__c
 FROM ((mstr_datamart.platform_dim pd JOIN mstr_datamart.publisher_dim pub ON ((pd.platform_id = pub.platform_id))) LEFT  JOIN mstr_datamart.SF_Product__c sfp ON (((pd.platform_name = sfp.Instance_ID__c) AND (sfp.RecordTypeId = '01280000000BgkgAAC'::varchar(18)) AND (NOT sfp.Non_Billable_Instance__c) AND (sfp.Status__c = 'Active'::varchar(6)))))) pub USING (publisher_account_nk)) LEFT  JOIN ( 
 SELECT (o.site_nk)::int AS site_nk,
        o.account_name AS publisher_account_name,
        o.account_id AS SF_Account_ID,
        sfa.Management_Reporting_Region__c AS MRR,
        sfa.Business_Type__c AS business_type,
        null AS mobl_app_adserver, --modified 20190904 as field is missing
        null AS video_adserver,  --modified 20190904 as field is missing
        sfa.PMP_Client_Fee__c AS pmp_client_fee,
        sfa.PMP_OX_Deal_Source_Fee__c AS pmp_ox_source_fee,
        sfa.RTG_Client_Fee__c AS rtg_client_fee,
        sfa.RTG_OX_Deal_Source_Fee__c AS rtg_ox_source_fee
 FROM (mstr_datamart.SF_Account sfa LEFT  JOIN mstr_datamart.dim_sites_to_owners o ON ((sfa.Id = o.account_id)))) sto ON ((f.site_nk = sto.site_nk))) LEFT  JOIN mstr_datamart.platform_dim apd ON ((f.a_platform_id = apd.platform_id))) LEFT  JOIN mstr_datamart.advertiser_dim adv ON ((f.advertiser_account_nk = adv.advertiser_account_nk))) LEFT  JOIN ( SELECT d.deal_nk,
        d.deal_source,
        d.has_multiple_publishers,
        t.pmp_deal_type_name
 FROM (mstr_datamart.deal_dim d LEFT  JOIN mstr_datamart.pmp_deal_type_mapping_dim t ON ((d.pmp_deal_type = t.pmp_deal_type)))) dd ON ((f.deal_nk = dd.deal_nk))) LEFT  JOIN mstr_datamart.line_item_dim lid ON ((f.line_item_nk = lid.line_item_nk)));"|false|false
